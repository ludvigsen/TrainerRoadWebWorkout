(this.webpackJsonpTrainerRoadWebWorkout=this.webpackJsonpTrainerRoadWebWorkout||[]).push([[0],{52:function(e,t,a){e.exports=a(84)},57:function(e,t,a){},84:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(45),i=a.n(o),c=(a(57),a(3)),u=a.n(c),s=a(21),l=a(22),m=a(2),d=function e(){Object(l.a)(this,e),this.workout={},this.workoutData=[],this.running=!1,this.startTime=void 0,this.pauseTime=void 0};Object(m.d)(d,{workout:m.f,workoutData:m.f,running:m.f,startTime:m.f,pauseTime:m.f});var f=Object(n.createContext)(new d);function h(e){var t;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,u.a.awrap(fetch("https://www.trainerroad.com/api/workoutdetails/".concat(e),{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})));case 2:return t=a.sent,a.abrupt("return",t.Workout);case 4:case"end":return a.stop()}}))}function v(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.awrap(fetch("https://www.trainerroad.com/api/workouts",{method:"post",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})));case 2:return e=t.sent,t.abrupt("return",e.Workouts);case 4:case"end":return t.stop()}}))}var w=a(11),p=a(46),g=function(){function e(){var t=this;Object(l.a)(this,e),this.powerData=[],this.heartRateMonitorData=[],this.cadenceData=[],this.addHr=function(e){t.heartRateMonitorData.push({time:Date.now(),value:e})},this.addPower=function(e){t.powerData.push({time:Date.now(),value:e})},this.addCadence=function(e){t.cadenceData.push({time:Date.now(),value:e})}}return Object(p.a)(e,[{key:"power",get:function(){return this.powerData.length>0?this.powerData[this.powerData.length-1].value:-1}},{key:"hr",get:function(){return this.heartRateMonitorData.length>0?this.heartRateMonitorData[this.heartRateMonitorData.length-1].value:-1}},{key:"cadence",get:function(){return this.cadenceData.length>0?this.cadenceData[this.cadenceData.length-1].value:-1}}]),e}();Object(m.d)(g,{powerData:m.f,heartRateMonitorData:m.f,cadenceData:m.f,power:m.b,hr:m.b,cadence:m.b});var k=Object(n.createContext)(new g),b=a(10),E={background:"#242424",foreground:"#fff",disabled:"#808080",graphColor:"#49a1e5"},y=function(e){var t=e.style,a=void 0===t?{}:t,o=e.ticks,i=void 0===o?[]:o,c=e.workoutData,u=void 0===c?[]:c,s=e.hrData,l=e.powerData,m=(e.currentTime,Object(n.useState)()),d=Object(w.a)(m,2),f=d[0],h=d[1];return r.a.createElement("div",{style:a},r.a.createElement(b.b,{margin:{color:"white",left:60,right:40}},r.a.createElement(b.d,null),r.a.createElement(b.a,{data:u,onValueMouseOver:h,onValueMouseOut:function(){return h(null)}},r.a.createElement(b.c,{value:f},r.a.createElement("div",null,r.a.createElement("span",null,"This is a test")))),s&&r.a.createElement(b.e,{color:"red",data:s}),l&&r.a.createElement(b.e,{color:"yellow",data:l}),r.a.createElement(b.f,{style:{fill:"white"},tickValues:i,tickFormat:function(e){return Math.ceil(e/1e3/60)}}),r.a.createElement(b.g,{style:{fill:"white"}})))},D=a(23),_={display:"flex",flexWrap:"wrap"},T=function(e){var t=e.children;return r.a.createElement("div",{style:Object(D.a)({},_)},t)},x={cursor:"pointer",fontSize:"1vw"};function O(e){return e&&!isNaN(e)&&e>=0||e&&e.length>0}var j=function(e){var t=e.title,a=e.value,n=e.width,o=e.onClick,i=void 0===o?function(){}:o;return r.a.createElement("div",{style:Object(D.a)({},x,{width:n}),onClick:i},r.a.createElement("h3",null,t),r.a.createElement("h2",{style:{fontSize:"5vw",color:O(a)?E.foreground:E.disabled}},O(a)?a:"---"))},C=a(34),R=a.n(C),S="heart_rate",M="cycling_speed_and_cadence",I="characteristicvaluechanged",W={heart_rate:"heart_rate_measurement",cycling_power:"cycling_power_measurement",cycling_speed_and_cadence:10843},A=["getInt16",2,!0],N=["getUint16",2,!0],U=[[0,[[A,"instantaneous_power"]]],[1,[[["getUint8",1],"pedal_power_balance"]]],[2,[]],[4,[[N,"accumulated_torque"]]],[8,[]],[16,[[["getUint32",4,!0],"cumulative_wheel_revolutions"],[N,"last_wheel_event_time"]]],[32,[[N,"cumulative_crank_revolutions"],[N,"last_crank_event_time"]]],[64,[[A,"maximum_force_magnitude"],[A,"minimum_force_magnitude"]]],[128,[[A,"maximum_torque_magnitude"],[A,"minimum_torque_magnitude"]]],[256,[[["getUint8",3],"maximum_minimum_angle"]]],[512,[[N,"top_dead_spot_angle"]]],[1024,[[N,"bottom_dead_spot_angle"]]],[2048,[[N,"accumulated_energy"]]],[4096,[]]],F={cycling_power:function(e){var t=2,a=e.getUint16(0,!0),n=U,r=[];if(0===n[0][0]){var o=!0,i=!1,c=void 0;try{for(var u,s=n[0][1][Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value;r.push(l)}}catch(H){i=!0,c=H}finally{try{o||null==s.return||s.return()}finally{if(i)throw c}}}var m=!0,d=!1,f=void 0;try{for(var h,v=n[Symbol.iterator]();!(m=(h=v.next()).done);m=!0){var p=h.value,g=Object(w.a)(p,2),k=g[0],b=g[1];if(a&k){var E=!0,y=!1,D=void 0;try{for(var _,T=b[Symbol.iterator]();!(E=(_=T.next()).done);E=!0){var x=_.value;r.push(x)}}catch(H){y=!0,D=H}finally{try{E||null==T.return||T.return()}finally{if(y)throw D}}}}}catch(H){d=!0,f=H}finally{try{m||null==v.return||v.return()}finally{if(d)throw f}}for(var O={},j=0,C=r;j<C.length;j++){var R=C[j],S=Object(w.a)(R,2),M=Object(w.a)(S[0],3),I=M[0],W=M[1],A=M[2],N=S[1],F=void 0;F=A?e[I](t,A):e[I](t),O[N]=F,t+=W}return O.instantaneous_power},heart_rate:function(e){return e.getUint8(1)}},H=function(e){return function(){var t,a,n,r,o,i,c,s=arguments;return u.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:function(){},"true"!==localStorage.getItem("simulation")){l.next=3;break}return l.abrupt("return",{device:{},server:{},start:function(){a=setInterval((function(){var a=e===S?300:e===M?120:180;t(Math.round(Math.random()*a))}),1e3)},stop:function(){clearInterval(a)}});case 3:return l.prev=3,n=function(a){var n=F[e](a.target.value);console.log("DATA: ",n),t(n)},l.next=7,u.a.awrap(navigator.bluetooth.requestDevice({filters:[{services:[e]}],optionalServices:[e]}));case 7:return r=l.sent,l.next=10,u.a.awrap(r.gatt.connect());case 10:return o=l.sent,l.next=13,u.a.awrap(o.getPrimaryService(e));case 13:return i=l.sent,l.next=16,u.a.awrap(i.getCharacteristic(W[e]));case 16:return c=l.sent,console.log("connected to ".concat(e)),c.addEventListener(I,n),c.startNotifications(),l.abrupt("return",{device:r,server:o,service:i,start:function(){c.startNotifications()},stop:function(){c.stopNotifications(),c.removeEventListener(I,n)}});case 23:return l.prev=23,l.t0=l.catch(3),console.error("Could not connect to any devices",l.t0),l.abrupt("return",null);case 27:case"end":return l.stop()}}),null,null,[[3,23]])}},P=H("cycling_power"),q=H(S),V=H(M),L={color:E.foreground,backgroundColor:E.background,display:"grid",textAlign:"center",position:"absolute",top:0,bottom:0,left:0,right:0},K={gridColumn:.5,height:"100%"},z=Object(s.a)((function(){var e=Object(n.useContext)(f),t=Object(n.useState)(),a=Object(w.a)(t,2),o=(a[0],a[1]),i=function t(){e.running&&o(Date.now()-e.startTime),c.current=requestAnimationFrame(t)},c=Object(n.useRef)();Object(n.useEffect)((function(){return c.current=requestAnimationFrame(i),function(){return cancelAnimationFrame(c.current)}}),[]);var s=Object(n.useContext)(k),l=e.workoutData.length>0?[e.workoutData[0].x,e.workoutData[Math.floor(e.workoutData.length/2)].x,e.workoutData[e.workoutData.length-1].x]:[],m=e.startTime?Date.now()-e.startTime:e.pauseTime?e.pauseTime-e.startTime:0,d=m?R.a.utc(m).format("HH:mm:ss.SSS"):"00:00:00.000",h=e.workout&&e.workout.intervalData&&e.workout.intervalData.filter((function(e){return!e.IsFake})).sort((function(e,t){return e.End-t.End})).find((function(e){return e.End>m/1e3}));console.log("workoutTime: ",m/1e3),console.log("INTERVAL",h),console.log("interval data",e.workout.intervalData);var v=h?R.a.utc(1e3*h.End-m).format("HH:mm:ss.SSS"):"00:00:00.000",p=e.workout.workoutData&&e.workout.workoutData.find((function(e){var t=e.seconds;return 1e3*Math.round((m||1)/1e3)===t}));return console.log("TARGET: ",p),r.a.createElement("div",{style:L},r.a.createElement(T,{style:K},r.a.createElement(j,{width:"25%",title:"POWER",value:s.power,onClick:function(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("CONNECTION POWER"),t.next=3,u.a.awrap(P((function(e){s.addPower(e)})));case 3:(e=t.sent)&&e.start();case 5:case"end":return t.stop()}}))}}),r.a.createElement(j,{width:"50%",title:"INTERVAL TIME",value:v}),r.a.createElement(j,{width:"25%",title:"HEART RATE",value:s.hr,onClick:function(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.awrap(q((function(e){s.addHr(e)})));case 2:(e=t.sent)&&e.start();case 4:case"end":return t.stop()}}))}}),r.a.createElement(j,{width:"25%",title:"TARGET",value:p?p.memberFtpPercent:"---"}),r.a.createElement(j,{width:"50%",title:"WORKOUT TIME",value:d,onClick:function(){e.running?(e.running=!1,e.pauseTime=Date.now()):(e.running=!0,e.startTime&&e.pauseTime?e.startTime=e.startTime+(Date.now()-e.pauseTime):e.startTime=Date.now())}}),r.a.createElement(j,{width:"25%",title:"CADENCE",value:s.cadence,onClick:function(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.awrap(V((function(e){s.addCadence(e)})));case 2:(e=t.sent)&&e.start();case 4:case"end":return t.stop()}}))}})),r.a.createElement(y,{style:K,ticks:l,workoutData:e.workoutData,currentTime:m,hrData:e.startTime?s.heartRateMonitorData.filter((function(t){return t.time-e.startTime>=0})).map((function(t){var a=t.value;return{x:t.time-e.startTime,y:a}})):[],powerData:e.startTime?s.powerData.filter((function(t){return t.time-e.startTime>=0})).map((function(t){var a=t.value;return{x:t.time-e.startTime,y:a}})):[]}))})),B=a(12),G=a(33),J=function(){var e=Object(B.f)().workoutId,t=Object(n.useContext)(f);return Object(n.useEffect)((function(){!function(){var a,n;u.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=6;break}return r.next=3,u.a.awrap(v());case 3:a=r.sent,console.log("WORKOUTS: ",a),e=a[4].Id;case 6:return r.next=8,u.a.awrap(h(e));case 8:n=r.sent,console.log("WORKOUT: ",n),t.workout=n,t.workoutData=n.workoutData.map((function(e){return{x:e.seconds,y:e.memberFtpPercent}}));case 12:case"end":return r.stop()}}))}()}),[t]),null},$=Object(s.a)((function(){return r.a.createElement(G.a,null,r.a.createElement(B.c,null,r.a.createElement(B.a,{path:"/:workoutId"},r.a.createElement(J,null),r.a.createElement(z,null)),r.a.createElement(B.a,{path:"/"},r.a.createElement(J,null),r.a.createElement(z,null))))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[52,1,2]]]);
//# sourceMappingURL=main.47988edc.chunk.js.map